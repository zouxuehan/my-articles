### 从输入url到页面展示，发生了什么

简单来说：

* DNS解析
* 建立TCP连接
* 发送HTTP请求
* HTTP响应
* 浏览器解析渲染页面
* 连接断开

详细说明：

![img](https://static001.geekbang.org/resource/image/92/5d/92d73c75308e50d5c06ad44612bcb45d.png)

* 用户输入url之后，浏览器进程将请求发送到网络进程
* 网络进程接收到之后：
  * 首先查找本地缓存是否有该资源，有则直接返回给浏览器进程
  * 没有则进行DNS解析，获取服务器IP地址
  * 与服务器建立TCP连接，发送HTTP请求
  * 服务器返回响应报文，如果响应文件类型为text/html，则通知浏览器进程
* 浏览器进程准备渲染进程（默认一个页面分配一个渲染进程，如果是同一站点则子页面复用父页面的渲染进程），通知渲染进程要提交文档
* 渲染进程接收到提交文档的消息后
  * 与网络进程建立传输管道
  * 文档传输完毕后，返回“确认提交”消息给浏览器进程
  * 开始页面解析和子资源加载进行渲染

#### 渲染过程

1. 构建DOM树：将html解析为DOM树结构
2. 样式计算：将css解析为样式表(styleSheets)，计算DOM树各节点的样式
3. 布局：将DOM树中的可见节点计算其几何位置，创建成布局树，
4. 分层：对布局树进行分层，生成分层树
5. 图层绘制：为每个图层生成绘制列表，提交给合成线程
6. 栅格化：合成线程将图层分成图块，在光栅化线程池将图块转换为位图
7. 合成绘制：合成线程发送绘制命令给浏览器进程
8. 浏览器进程生成页面显示

![img](https://static001.geekbang.org/resource/image/97/37/975fcbf7f83cc20d216f3d68a85d0f37.png)

### 重绘回流

* 重绘：改变元素样式
* 回流：改变DOM树几何位置，需要重新布局，回流一定引起重绘



### 浏览器存储

| 特性     | cookie               | localStorage                       | seesionStorage               | indexDB                |
| -------- | -------------------- | ---------------------------------- | ---------------------------- | ---------------------- |
| 生命周期 | 服务器设置过期时间   | 除非清理，否则一直存在             | 页面关闭被清理               | 除非清理，否则一直存在 |
| 存储大小 | 4k                   | 5M                                 | 5M                           | 无限                   |
| 页面共享 | \                    | 相同域名页面共享                   | 只存在当前页面               | \                      |
| 通信     | 域名下所有请求都携带 | \                                  | \                            | \                      |
| 应用     |                      | 稳定资源（个性化主题、base64图片） | 表单维护、会话状态、浏览信息 |                        |

### 垃圾回收机制

